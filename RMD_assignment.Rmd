---
title: "Gapminder Analysis"
author: "Chris Toole & Max Pohlman"
date: "February 28, 2017"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction
Gapminder dataset analysis and trends.

```{r load data, echo=FALSE, message=FALSE}
library(magrittr)
library(ggplot2)
library(plyr)
library(dplyr)
library(curl)
gapminder_location<-curl(url="https://raw.githubusercontent.com/resbaz/r-novice-gapminder-files/master/data/gapminder-FiveYearData.csv")
gapminder<-read.csv(gapminder_location,stringsAsFactors = FALSE)
#function calculates total gdp
calcgdp <- function(dat,year=NULL,country=NULL){
  if(!is.null(year)) {
    dat<- dat[dat$year %in% year,]
  }
  if(!is.null(country)) {
    dat<- dat[dat$country %in% country,]
  }
  gdp<-dat$gdpPercap*dat$pop
  dat<-cbind(dat,gdp)
  return(dat)
}
newgap<-calcgdp(gapminder)

```

## Analysis
The first thing we did was we looked at the correlation between life expectancy and GDP per capita using the following code:

```{r firsttable, echo=TRUE, eval=FALSE}
cor(gapminder$lifeExp, gapminder$gdpPercap)
```
The correlation between life expextancy and GDP per capita is `r cor(gapminder$lifeExp, gapminder$gdpPercap)`

We then decided to visualize the relationship between the two variables by using a scatter plot.

```{r plotting, echo=FALSE, fig.align='center'}
ggplot(data = gapminder, aes(x = lifeExp, y = gdpPercap)) +
  geom_point()
```
This looks like there's a clear relationship between gdp and life expectancy! The plot appears exponential so the same plot was created below with a logarithmic scale of base 10 applied to the y-axis and then fit to a linear model. 

``` {r plottwo, echo=FALSE, fig.align='center', fig.width = 7, fig.height = 3}
ggplot(data=gapminder, aes(x=lifeExp, y=gdpPercap))+
  geom_point()+scale_y_log10()+geom_smooth(method=lm)
```
The above analysis was then performed on total GDP. The correlation between life expextancy and total GDP is `r cor(newgap$lifeExp, newgap$gdp)`. 

```{r plotting3, echo=FALSE, fig.align='center'}
ggplot(data = newgap, aes(x = lifeExp, y = gdp)) +
  geom_point()
```
It appears there are several exponential trends above so let's separate by continent.

```{r plotting4, echo=FALSE, fig.align='center', fig.width = 7, fig.height = 4}
ggplot(data = newgap, aes(x = lifeExp, y = gdp, color=continent)) +
  geom_point()
```
Then apply the logarithmic scale to the y axis and fit to linear model.

``` {r plot5, echo=FALSE, fig.align='center'}
ggplot(data=newgap, aes(x=lifeExp, y=gdp, color=continent))+
  geom_point()+scale_y_log10()+geom_smooth(method=lm)
```

Now lets take a look at life expectancy by continent.
```{r barchart, echo=FALSE, fig.align='center', fig.width = 7, fig.height = 4}
plottable<-ddply(gapminder,~continent,summarise,lifeexp=mean(lifeExp))
ggplot(data = plottable, aes(continent, lifeexp, fill=continent)) +
   geom_bar(stat="identity")
```

Unsurprisingly, Africa, the poorest continent, has the lowest life expectancy. However, this might have improved over time. We then plotted life expectancy over time for each country.

```{r maxlinechart, echo=FALSE, message=FALSE, fig.align='center'}
asdf<-ddply(gapminder,c("continent","year"),summarise, lifeexp=mean(lifeExp)) 
ggplot(asdf, aes(year, lifeexp, color=continent)) +
  geom_smooth(se=FALSE)
```

It looks like Africa's average life expectancy increased at approximately the same rate as the other continents until around 1987.

Furthermore, the Americas seem low. This might be because North and South America are combined. Let's now split them up:

```{r americasone, echo=FALSE}
gapminder$america[gapminder$country=='Canada'|gapminder$country=='United States'] <- "North America"
gapminder$america[
  gapminder$country=='Mexico'|
  gapminder$country=='Costa Rica'|
  gapminder$country=='Cuba'|
  gapminder$country=='Dominican Republic'|
  gapminder$country=='Jamaica'|
  gapminder$country=='Puerto Rico'|
  gapminder$country=='Haiti'|
  gapminder$country=='Honduras'|
  gapminder$country=='Panama'|
  gapminder$country=='El Salvador'|
  gapminder$country=='Guatemala'|
  gapminder$country=='Nicaragua'
  ]<- "Central America"
gapminder$america[
    gapminder$country=='Brazil'|
    gapminder$country=='Argentina'|
    gapminder$country=='Bolivia'|
    gapminder$country=='Chile'|
    gapminder$country=='Colombia'|
    gapminder$country=='Ecuador'|
    gapminder$country=='Paraguay'|
    gapminder$country=='Peru'|
    gapminder$country=='Venezuela'|
    gapminder$country=='Trinidad and Tobago'|
    gapminder$country=='Uruguay'
  ]<- "South America"
NAnames<-unique(gapminder$country[gapminder$america=='North America'])
NAnames<-NAnames[!is.na(NAnames)]
CAnames<-unique(gapminder$country[gapminder$america=='Central America'])
CAnames<-CAnames[!is.na(CAnames)]
SAnames<-unique(gapminder$country[gapminder$america=='South America'])
SAnames<-SAnames[!is.na(SAnames)]
```
The countries we classified as North America were `r NAnames`

The countries we classified as Central America were `r CAnames`

The countries we classified as South America were `r SAnames`

```{r maxlinecharttwo, echo=FALSE, message=FALSE, fig.width = 7, fig.height = 4, fig.align='center'}
plottable<-ddply(subset(gapminder, continent == 'Americas'),c("america","year"),summarise, lifeexp=mean(lifeExp)) 
ggplot(plottable, aes(year, lifeexp, color=america)) +
  geom_smooth(se=FALSE)
```
Wow! There appears to be quite the difference between North America and the other two Americas. Let's verify this with a t-test for difference of means to see if they are significantly different.

```{r maxttest, echo=FALSE}
NAvalues<-gapminder$lifeExp[gapminder$america=='North America']
CASAvalues<-gapminder$lifeExp[gapminder$america=='Central America' | gapminder$america=="South America"]
t.test(NAvalues,CASAvalues)
```

With a t stat of a whopping 11.14, there is a significant difference between life expectancy in North America and the other two Americas.

#to be moved

```{r plot, echo=FALSE, fig.align='center'}
#plot lifeexp (y) vs time (x)
ggplot(data=gapminder, aes(x=year, y=lifeExp))+
  geom_point()+geom_smooth(method=lm)
```

Above plot shows trend.